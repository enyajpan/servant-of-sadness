<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no, user-scalable=no">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script
      src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
      integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
      crossorigin="anonymous"></script>
    <script src="./StartAudioContext.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/13.0.1/Tone.min.js"></script>

    <link rel="stylesheet" href="./styles.css">

    <link rel="icon" type="image/png" href="assets/favicon.png">
  </head>

  <!-- pop-up instructions -->
  <div id="popup-overlay">
    <div id="popup-container">
      <button id="close-popup">×</button>
      <img src="assets/intro.png" alt="Intro" id="popup-image">
    </div>
  </div>
  
  
  <body>
    <!-- Fixed page title -->
    <div id="fixed-header">
      <a href="https://enyajpan.github.io/in-case-of-loss/" target="_top">
        In case of loss, please return to:
      </a>
    </div>
    
    <div id="sort-controls">    

    <!-- Fixed header row -->
    <div id="fixed-th">
      <div class="line header-line">
        <div class="column number">id.</div>
        <div class="column title scramble">Subject line:</div>
        <div class="column author scramble">From:</div>           
        <div class="column message">
          <span class="header-label scramble">Message</span>
          <button id="sort-button" class="sort-button">Sort: Oldest First ↑</button>
        </div>             
        <div class="column label">Label</div> 
        <div class="column timestamp scramble">Timestamp</div>
      </div>
    </div>

      <!-- Scrollable area -->
      <div id="scroll-wrapper">
        <div id="container-wrapper">
          <div id="container">
            <!-- content like #header, entries, etc -->
          </div>
        </div>

    <div id="container-wrapper">
      <img 
        id="container-bg" 
        src="assets/view-all-background.png" 
        alt="view all background" 
        oncontextmenu="return false;"
      />
    </div>

    <div id="submission-wrapper">
      <img 
        id="submission-bg" 
        src="assets/submission-form-background.png" 
        alt="submission form background" 
        oncontextmenu="return false;" 
      />
      <div id="submission-overlay">
        <form id="submission-form" novalidate>
          <!-- Checkboxes -->
          <div class="label-wrapper">
            <div class="label-title">Select label:</div>
            <div class="label-column">
              <label class="custom-checkbox">
                <input type="checkbox" name="label" value="missed-connections" />
                <span class="checkmark"></span> missed-connections
              </label>
              <label class="custom-checkbox">
                <input type="checkbox" name="label" value="past-lives" />
                <span class="checkmark"></span> past-lives
              </label>
              <label class="custom-checkbox">
                <input type="checkbox" name="label" value="404-error" />
                <span class="checkmark"></span> 404-error
              </label>
              <label class="custom-checkbox">
                <input type="checkbox" name="label" value="servant-of-sadness" />
                <span class="checkmark"></span> servant-of-sadness
              </label>
            </div>
            <span class="error-message" id="error-label"></span>
          </div>

          <!-- Stack subject + author -->
          <input name="number" type="hidden" />
          <div class="input-stack">
            <input name="subject line" placeholder="Subject" required />
            <span class="error-message" id="error-subject"></span>
            <input name="author" placeholder="Your name" required />
            <span class="error-message" id="error-author"></span>
          </div>          

          <!-- Message on separate row -->
          <div class="message-wrapper">
            <textarea name="message" placeholder="Write your message here. What do you want to leave with the world?" required></textarea>
            <span class="error-message" id="error-message"></span>
          </div>

          <button type="post">Post !!</button>
        </form>                          
      </div>
    </div>

    <div id="spacer"></div>
      </div>
      <script>
        function scrambleText(el, originalText) {
          const chars = "!<>-_\\/[]{}—=+*^?#________";
          const duration = 600;
          const steps = 20;
          let frame = 0;
      
          const scrambleInterval = setInterval(() => {
            let output = "";
      
            for (let i = 0; i < originalText.length; i++) {
              if (frame > steps) {
                output += originalText[i];
              } else if (Math.random() < frame / steps) {
                output += originalText[i];
              } else {
                output += chars[Math.floor(Math.random() * chars.length)];
              }
            }
      
            el.textContent = output;
            frame++;
      
            if (frame > steps) {
              clearInterval(scrambleInterval);
            }
          }, duration / steps);
        }
      
        document.querySelectorAll('.scramble').forEach(el => {
          const originalText = el.textContent;
          el.addEventListener('mouseenter', () => {
            scrambleText(el, originalText);
          });
        });
      </script>
    
    <!-- Thank You Popup -->
    <div id="thank-you-popup" style="display: none;">
      <div class="popup-content">
        <button id="close-thank-you">Close</button>
        <img src="assets/thank-you.png" alt="Thank you" />
      </div>
    </div>


    </body>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script src="./script.js"></script>
</html>
